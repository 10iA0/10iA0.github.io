<!doctype html><html lang=en><head><meta name=viewport content="width=device-width,initial-scale=1"><title>Horseman, pass by.</title><meta charset=utf-8><meta name=description content="Ladder@Postgresql on Data Analysis - Horseman, pass by."><meta name=author content="Jihang XIAO"><link rel=canonical href=https://10iA0.github.io/blog/postgresql-on-data-analysis/><meta property="og:title" content="Postgresql on Data Analysis"><meta property="og:description" content><meta property="og:type" content="article"><meta property="og:url" content="https://10iA0.github.io/blog/postgresql-on-data-analysis/"><meta property="article:section" content="blog"><meta property="article:published_time" content="2018-03-25T16:43:00+00:00"><meta property="article:modified_time" content="2018-03-25T16:43:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Postgresql on Data Analysis"><meta name=twitter:description content><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Blogs","item":"https://10iA0.github.io/blog/"},{"@type":"ListItem","position":3,"name":"Postgresql on Data Analysis","item":"https://10iA0.github.io/blog/postgresql-on-data-analysis/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Postgresql on Data Analysis","name":"Postgresql on Data Analysis","description":"","keywords":["psycopg2","SQL","Postgresql on Python"],"articleBody":"How to use Database There are two types of database: SQL database and NoSQL database. SQL and NoSQL are complementary to satisfy kinds of demands for data adminstration. The brief descriptions on SQL and NoSQL refer to What is SQL and NoSQL? - Part1 and What is SQL and NoSQL? - Part2.\nPostgreSQL Install I installed postgres guided by the official document.\nTo install PostgreSQL on WSL (ie. Ubuntu):\nOpen your WSL terminal (ie. Ubuntu). Update your Ubuntu packages: sudo apt update Once the packages have updated, install PostgreSQL (and the -contrib package which has some helpful utilities) with: sudo apt install postgresql postgresql-contrib Confirm installation and get the version number: psql --version Along with the guide above, we have installed PostgreSQL. There are 3 commands we need to know once PostgreSQL is installed:\nsudo service postgresql status to check the status of the database. sudo service postgresql start to start running the database. sudo service postgresql stop to stop running the database. Admin user The default admin user, postgres, needs a password assigned in order to connect to a database. To set a password:\nEnter the command: sudo passwd postgres We will get a prompt to enter your new password. Close and reopen our terminal. To see what user accounts have been created on your PostgreSQL installation, use from your WSL terminal: psql -c \"\\du\" …or just \\du if you have the psql shell open. This command will display columns: Account User Name, List of Roles Attributes, and Member of role group(s). To exit back to the command line, enter: q.\npsql shell To run PostgreSQL with psql shell:\nStart our postgres service: sudo service postgresql start Connect to the postgres service and open the psql shell: sudo -u postgres psql Once we have successfully entered the psql shell, we will see our command line change to look like this: postgres=# Note: Alternatively, you can open the psql shell by switching to the postgres user with: su - postgres and then entering the command: psql.\nTo exit postgres=# enter: \\q or use the shortcut key: Ctrl+D\nCommon user Though we have admin user, it not a wise idea to use admin user everywhere. We better create an role for ourselves and create databases for our role so that we can add, delete, update and query data for ourselves in these databaes and avoid any potential destructive operation to the whole database. Now we will cerate a database user and a linux user with the same name for ourselves and use linux user to administer our databases as the role of linux user.\nOpen the psql shell:\nsudo -u postgres psql Create a database user:\ncreate user with password 'passwd'; Create a database:\ncreate database OWNER ; Grant all privileges on the database to the user:\nGRANT ALL PRIVILEGES ON DATABASE TO ; Exit back to the command line:\n\\q Create a linux user:\n# The name of linux user must be the same as the name of database we have crteated. sudo adduser sudo passwd Connect the database as the role su - psql -d VS Code To work with with PostgreSQL databases in VS Code, try the PostgreSQL extension.\npsycopg2 This part is translated from an essay in CSDN in the assumption that we have installed and configured PostgreSQL.\nInstall Install psycopg2:\napt-get install python-psycopg2 Import psycopg2:\nimport psycopg2 connection class Create a connection class:\npsycopg2.connect() create a new session in database and return a connection class.\nconn = psycopg2.connect(dbname=\"databae_name\", user=\"user_name\", password=\"passwd\", host=\"127.0.0.1\", port=\"5432\") The common methods we use in connection:\ncommit() to commit transaction to database; rollback() to roll back; close() to close database. cursor class Create a cursor class\npsycopg2 provides a cursor class to execute commands in session. connection.cursor() creates a cursor class.\ncur = conn.cursor() The common methods we use in cursor:\nexecute(query, vars=None) to execute SQL; fetchall() to fetch all outputs of querys and return values as a list containing tuples. Once we have the cursor class, we could take operation in a database.\nAutocommit Make autocommit to be true so that each action is committed without having to call conn.commit() after each command.\nconn.set_session(autocommit=True) SQL Create cur.execute( 'CREATE TABLE Employee (' 'name varchar(80),' 'address varchar(80),' 'age int,' 'date date' ')' ) Insert cur.execute(\"INSERT INTO Employee \" \"VALUES('Gopher', 'China Beijing', 100, '2017-05-27')\") Query cur.execute(\"SELECT * FROM Employee\") rows = cur.fetchall() for row in rows: print('name=' + str(row[0]) + ' address=' + str(row[1]) + ' age=' + str(row[2]) + ' date=' + str(row[3])) Update cur.execute(\"UPDATE Employee SET age=12 WHERE name='Gopher'\") Delete cur.execute(\"DELETE FROM Employee WHERE name='Gopher'\") ","wordCount":"771","inLanguage":"en","datePublished":"2018-03-25T16:43:00Z","dateModified":"2018-03-25T16:43:00Z","author":{"@type":"Person","name":"Jihang XIAO"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://10iA0.github.io/blog/postgresql-on-data-analysis/"},"publisher":{"@type":"Organization","name":"Horseman, pass by.","logo":{"@type":"ImageObject","url":"https://10iA0.github.io/favicon.ico"}}}</script><link rel=icon type=image/png href=/images/sun.png sizes=16x16><link rel=apple-touch-icon href=/images/sun.png><link rel=manifest href=/images/sun.png><link rel=stylesheet href=/css/main.min.64bc8c4cb2304e84167c1583fa1b5de80f6d5adc95abed2e616dea0ea5680e01.css integrity="sha256-ZLyMTLIwToQWfBWD+htd6A9tWtyVq+0uYW3qDqVoDgE=" crossorigin=anonymous media=screen><link rel=stylesheet href=/scss/highlight/github-dark.min.min.66034289ee9a113219a2c4aae0a8bd2095ab255c832a42efcf5863f10814e7a1.css><script src=/js/highlight.min.min.c098d85b5396dec4707ea2cead1445b4dc2ff0fc56b8dbbd9049d0d1c50ad237.js></script>
<script>hljs.highlightAll()</script><script>(()=>{var t=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,e=localStorage.getItem("theme");t&&e===null&&(localStorage.setItem("theme","dark"),document.documentElement.setAttribute("data-dark-mode","")),t&&e==="dark"&&document.documentElement.setAttribute("data-dark-mode",""),e==="dark"&&document.documentElement.setAttribute("data-dark-mode","")})()</script></head><body><main class=wrapper><nav class=navigation><section class=container><a class=navigation-brand href=/></a><input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><span></span><span></span><span></span></label><ul class=navigation-list id=navigation-list><li class="navigation-item navigation-menu"><a class=navigation-link href=/>Home</a></li><li class="navigation-item navigation-menu"><a class=navigation-link href=/archives>Post</a></li><li class="navigation-item navigation-menu"><a class=navigation-link href=/tags>Tags</a></li><li class="navigation-item navigation-menu"><a class=navigation-link href=/about>About</a></li><li class="navigation-item menu-separator"><span>|</span></li><li class="navigation-item navigation-social"><a class=navigation-link href=https://github.com/10iA0><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a></li><li class="navigation-item navigation-dark"><button id=mode type=button aria-label="toggle user light or dark theme">
<span class=toggle-dark><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-moon"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg></span><span class=toggle-light><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-sun"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></span></button></li><li class="navigation-item navigation-language"><a href=https://10iA0.github.io/zh/>中</a></li></ul></section></nav><div id=content><article class=blog-single><header class=blog-title><h1>Postgresql on Data Analysis</h1></header><p><small>March 25, 2018&nbsp;· 771 words&nbsp;· 4 min</small>
<small>·
<a href=https://10iA0.github.io/tags/psycopg2/>psycopg2</a>
<a href=https://10iA0.github.io/tags/sql/>SQL</a>
<a href=https://10iA0.github.io/tags/postgresql-on-python/>Postgresql on Python</a></small><p><div class=blog-toc><nav id=TableOfContents><ul><li><a href=#postgresql>PostgreSQL</a><ul><li><a href=#install>Install</a></li><li><a href=#admin-user>Admin user</a></li><li><a href=#psql-shell>psql shell</a></li><li><a href=#common-user>Common user</a></li><li><a href=#vs-code>VS Code</a></li></ul></li><li><a href=#psycopg2>psycopg2</a><ul><li><a href=#install-1>Install</a></li><li><a href=#connection-class>connection class</a></li><li><a href=#cursor-class>cursor class</a></li><li><a href=#autocommit>Autocommit</a></li><li><a href=#sql>SQL</a></li></ul></li></ul></nav></div><section class=blog-content><h1 id=how-to-use-database>How to use Database</h1><p>There are two types of database: SQL database and NoSQL database. SQL and NoSQL are complementary to satisfy kinds of demands for data adminstration. The brief descriptions on SQL and NoSQL refer to <a href=https://cloud.tencent.com/developer/article/1132555>What is SQL and NoSQL? - Part1</a> and <a href=https://cloud.tencent.com/developer/article/1132589>What is SQL and NoSQL? - Part2</a>.</p><h2 id=postgresql>PostgreSQL</h2><h3 id=install>Install</h3><p>I installed postgres guided by the <a href=https://learn.microsoft.com/en-us/windows/wsl/tutorials/wsl-database#install-postgresql>official document</a>.</p><blockquote><p>To install PostgreSQL on WSL (ie. Ubuntu):</p><ol><li>Open your WSL terminal (ie. Ubuntu).</li><li>Update your Ubuntu packages: <code>sudo apt update</code></li><li>Once the packages have updated, install PostgreSQL (and the -contrib package which has some helpful utilities) with: <code>sudo apt install postgresql postgresql-contrib</code></li><li>Confirm installation and get the version number: <code>psql --version</code></li></ol></blockquote><p>Along with the guide above, we have installed PostgreSQL. There are 3 commands we need to know once PostgreSQL is installed:</p><ul><li><code>sudo service postgresql status</code> to check the status of the database.</li><li><code>sudo service postgresql start</code> to start running the database.</li><li><code>sudo service postgresql stop</code> to stop running the database.</li></ul><h3 id=admin-user>Admin user</h3><p>The default admin user, <code>postgres</code>, needs a password assigned in order to connect to a database. To set a password:</p><ol><li>Enter the command: <code>sudo passwd postgres</code></li><li>We will get a prompt to enter your new password.</li><li>Close and reopen our terminal.</li></ol><p>To see what user accounts have been created on your PostgreSQL installation, use from your WSL terminal: <code>psql -c "\du"</code> &mldr;or just <code>\du</code> if you have the psql shell open. This command will display columns: Account User Name, List of Roles Attributes, and Member of role group(s). To exit back to the command line, enter: <code>q</code>.</p><h3 id=psql-shell>psql shell</h3><p>To run PostgreSQL with psql shell:</p><ol><li>Start our postgres service: <code>sudo service postgresql start</code></li><li>Connect to the postgres service and open the psql shell: <code>sudo -u postgres psql</code></li><li>Once we have successfully entered the psql shell, we will see our command line change to look like this: <code>postgres=#</code></li></ol><blockquote><p><code>Note</code>: Alternatively, you can open the psql shell by switching to the postgres user with: <code>su - postgres</code> and then entering the command: <code>psql</code>.</p></blockquote><p>To exit postgres=# enter: <code>\q</code> or use the shortcut key: Ctrl+D</p><h3 id=common-user>Common user</h3><p>Though we have admin user, it not a wise idea to use admin user everywhere. We better create an role for ourselves and create databases for our role so that we can add, delete, update and query data for ourselves in these databaes and avoid any potential destructive operation to the whole database. Now we will cerate a database user and a linux user with the same name for ourselves and use linux user to administer our databases as the role of linux user.</p><p>Open the psql shell:</p><pre tabindex=0><code>sudo -u postgres psql
</code></pre><p>Create a database user:</p><pre tabindex=0><code>create user &lt;user_name&gt; with password &#39;passwd&#39;;
</code></pre><p>Create a database:</p><pre tabindex=0><code>create database &lt;database_name&gt; OWNER &lt;user_name&gt;;
</code></pre><p>Grant all privileges on the database to the user:</p><pre tabindex=0><code>GRANT ALL PRIVILEGES ON DATABASE &lt;database_name&gt; TO &lt;user_name&gt;;
</code></pre><p>Exit back to the command line:</p><pre tabindex=0><code>\q
</code></pre><p>Create a linux user:</p><pre tabindex=0><code># The name of linux user must be the same as the name of database we have crteated.

sudo adduser &lt;user_name&gt;

sudo passwd &lt;user_name&gt;
</code></pre><p>Connect the database &lt;database_name> as the role &lt;user_name></p><pre tabindex=0><code>su - &lt;user_name&gt;

psql -d &lt;database_name&gt;
</code></pre><h3 id=vs-code>VS Code</h3><p>To work with with PostgreSQL databases in VS Code, try the <a href="https://marketplace.visualstudio.com/items?itemName=ms-ossdata.vscode-postgresql">PostgreSQL extension</a>.</p><h2 id=psycopg2>psycopg2</h2><p>This part is translated from an <a href=https://blog.csdn.net/u011304970/article/details/72771775>essay</a> in CSDN in the assumption that we have installed and configured PostgreSQL.</p><h3 id=install-1>Install</h3><p>Install psycopg2:</p><pre tabindex=0><code>apt-get install python-psycopg2
</code></pre><p>Import psycopg2:</p><pre tabindex=0><code>import psycopg2
</code></pre><h3 id=connection-class>connection class</h3><p>Create a connection class:</p><p>psycopg2.connect() create a new session in database and return a connection class.</p><pre tabindex=0><code>conn = psycopg2.connect(dbname=&#34;databae_name&#34;, user=&#34;user_name&#34;, password=&#34;passwd&#34;, host=&#34;127.0.0.1&#34;, port=&#34;5432&#34;)
</code></pre><p>The common methods we use in connection:</p><ul><li>commit() to commit transaction to database;</li><li>rollback() to roll back;</li><li>close() to close database.</li></ul><h3 id=cursor-class>cursor class</h3><p>Create a cursor class</p><p>psycopg2 provides a cursor class to execute commands in session. connection.cursor() creates a cursor class.</p><pre tabindex=0><code>cur = conn.cursor()
</code></pre><p>The common methods we use in cursor:</p><ul><li>execute(query, vars=None) to execute SQL;</li><li>fetchall() to fetch all outputs of querys and return values as a list containing tuples.</li></ul><p>Once we have the cursor class, we could take operation in a database.</p><h3 id=autocommit>Autocommit</h3><p>Make autocommit to be true so that each action is committed without having to call conn.commit() after each command.</p><pre tabindex=0><code>conn.set_session(autocommit=True)
</code></pre><h3 id=sql>SQL</h3><h4 id=create>Create</h4><pre tabindex=0><code>cur.execute(
        &#39;CREATE TABLE Employee (&#39;
        &#39;name    varchar(80),&#39;
        &#39;address varchar(80),&#39;
        &#39;age     int,&#39;
        &#39;date    date&#39;
        &#39;)&#39;
    )
</code></pre><h4 id=insert>Insert</h4><pre tabindex=0><code>cur.execute(&#34;INSERT INTO Employee &#34;
        &#34;VALUES(&#39;Gopher&#39;, &#39;China Beijing&#39;, 100, &#39;2017-05-27&#39;)&#34;)
</code></pre><h4 id=query>Query</h4><pre tabindex=0><code>cur.execute(&#34;SELECT * FROM Employee&#34;)
rows = cur.fetchall()
for row in rows:
    print(&#39;name=&#39; + str(row[0]) + &#39; address=&#39; + str(row[1]) + 
        &#39; age=&#39; + str(row[2]) + &#39; date=&#39; + str(row[3]))
</code></pre><h4 id=update>Update</h4><pre tabindex=0><code>cur.execute(&#34;UPDATE Employee SET age=12 WHERE name=&#39;Gopher&#39;&#34;)
</code></pre><h4 id=delete>Delete</h4><pre tabindex=0><code>cur.execute(&#34;DELETE FROM Employee WHERE name=&#39;Gopher&#39;&#34;)
</code></pre></section><div class=paginator><a class=prev href=https://10iA0.github.io/blog/location-analysis/><span>&larr;&nbsp;&nbsp;</span><span>Location Analysis</span></a>
<a class=next href=https://10iA0.github.io/blog/anaconda-operation/><span>Anaconda Operation</span><span>&nbsp;&nbsp;&rarr;</span></a></div><div class=related-resources><h3>Related Resources</h3></div></article></div><footer class=footer><p>&copy; 2022 <a href=https://10iA0.github.io>Horseman, pass by.</a>
Powered by
<a href=https://gohugo.io/ rel=noopener target=_blank>Hugo️️</a>
<a href=https://github.com/guangzhengli/hugo-theme-ladder rel=noopener target=_blank>Ladder</a>
️</p></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-up"><line x1="12" y1="19" x2="12" y2="5"/><polyline points="5 12 12 5 19 12"/></svg></a><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.querySelectorAll("pre > code").forEach(e=>{const s=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="Copy";function n(){t.innerHTML="Copied",setTimeout(()=>{t.innerHTML="Copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),n();return}const s=document.createRange();s.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(s);try{document.execCommand("copy"),n()}catch{}o.removeRange(s)}),e.parentNode.appendChild(t)})</script></main></body><script src=https://cdnjs.cloudflare.com/ajax/libs/medium-zoom/1.0.6/medium-zoom.min.js integrity="sha512-N9IJRoc3LaP3NDoiGkcPa4gG94kapGpaA5Zq9/Dr04uf5TbLFU5q0o8AbRhLKUUlp8QFS2u7S+Yti0U7QtuZvQ==" crossorigin=anonymous referrerpolicy=no-referrer></script>
<script>const images=Array.from(document.querySelectorAll(".blog-content img"));images.forEach(e=>{mediumZoom(e,{margin:10,scrollOffset:40,container:null,template:null,background:"rgba(0, 0, 0, 0.5)"})})</script><script src=/main.min.6bb26b69159420159c74dc9e097b06a578ed2b68c701466a91a44a9632d851bd0af167a1b30012387b4c512b48ad9ad4d3394e04d77ae38d57e1920fe4ed34fe.js integrity="sha512-a7JraRWUIBWcdNyeCXsGpXjtK2jHAUZqkaRKljLYUb0K8WehswASOHtMUStIrZrU0zlOBNd6441X4ZIP5O00/g==" crossorigin=anonymous defer></script></html>